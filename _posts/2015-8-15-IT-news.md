---
layout: post
title: " 阿里副总裁章文嵩：淘宝基础设施构建实践 "
date: 2015-8-15
categories: IT
tags: [业界新闻]
---
阿里副总裁章文嵩：淘宝基础设施构建实践

<!-- more -->

最近在看一本书，叫《淘宝技术这十年》，看到以下这段话的时候，我突然觉得自己很渺小了（虽然本来就很渺小了），因为感觉那些做技术的大牛真的不是一般的厉害。

“因为同一时刻访问www.taobao.com的人数过于巨大，所以，
即便是生成淘宝首页页面的服务器，也不可能仅有一台，仅用于
生成www.taobao.com首页的服务器就可能有成百上千台，那么你
的一次访问时生成页面给你看的任务便会被分配给其中一台服务
器完成。这个过程要保证公正、公平、平均（即这成百上千台服
务器每台负担的用户数要差不多），这一很复杂的过程由几个系
统配合完成，其中最关键的便是LVS（Linux Virtual Server，世界
上最流行的负载均衡系统之一，是由目前在淘宝网供职的章文嵩
博士开发的）。”(注释：1998年5月创立LVS）
————出自《淘宝技术这十年》

以下的这篇演讲稿是章文嵩博士在第七届“开源中国 开源世界”高峰论坛中发表的一篇演讲：

**阿里副总裁章文嵩发表《淘宝基础设施构建实践》主题演讲，他表示淘宝是开源系统的受益者，并积极参与开源生态系统的建设，促进开源生态系统的发展，积累更好的口碑，凝聚人才，迎接未来更大的技术挑战。淘宝公司希望以更开放的方式与世界一起进行技术创新。**

###演讲实录：

我叫章文嵩，我在阿里集团做基础平台，今天跟大家分享一下我们在底层基础平台建设方面的一些经验。分几个议题，首先介绍一下淘宝网，然后介绍一下目前软件基础设施的情况，通过事例看看我们是怎么走过来的，有三个典型事例，从图片储存到CDN再到数据库，然后分享一下淘宝的开源策略。

###网购代名词——淘宝网

淘宝网简介，可能很多人都知道淘宝网是一个网络购物的代名词，有市场报告显示，去年淘宝网交易额是7800多亿，淘宝网占7层份额，淘宝网上面大概有七八百万卖家创造了直接的就业机会，职业就业机会270多万个，淘宝网的网络流量，目前基本上在13名左右，第一名谷歌，第二名FACEBOOK，这个排名会条约，比如我们做大促时候，有可能冲到11名，过年时候网络购物少的时候可能降到18名，国内是第3名。支撑网站排名背后的流量一天现在大概700多万个访客，我们跟踪帐户登陆，有700多万个，去年双12大促一天有1.25亿人访问，那时候CDN访问流量856G，整个淘宝网页一天25亿，淘宝网站上有800多个应用。针对这样的规模搭建基础设施也并不容易，我们的基础设施每年在不断的发展，可能以百分之七八十速度在增长。

###淘宝基础设施

淘宝的基础设施，最上面是CND系统，我们在全国布很多点，让用户访问家门口的机器，中间是交易平台，背后是基础设施软件，存储系统，我们有数据库，包括海量数据处理平台和资源调度平台，左侧有淘宝的搜索，淘宝上有十几亿商品，用户进来要搜索，我们要做到实时搜索，比如用户变更了价格，在搜索引擎里几秒钟要反映出来，卖家变更一些信息之后往往自己上去查，如果查不到自己就会投诉。右侧是广告系统，是收入的主要来源，还有数据挖掘平台。在基础软件上，我们分很多层次来做，最底下的是硬件，我们对硬件进行定制，我们对各种储存介质非常了解，我们在低功耗处理器、CPU方面定制专门机器，降低功耗比，或者降低成本。

我们有一个内核的团队，几万台服务器支撑淘宝网，我们根据应用的特点做优化，过去Apache用的比较多，我们还有数据库团队，这是目前在单机上做的事情。上面是分布式系统，多机环境，有分布式存储，像TFS、分布式表格系统，还有图像搜索团队，图像搜索输入一张照片，我们有CDN分发系统，还有海量数据的计算，包括旺旺平台，现在将近一千万同事在线，虚拟化管理，负载均衡，包括网络的解决方案。

现在采用的软件基本都是开源加自主开发的，比如CDN，我们可以说它是世界上最大的面向图像的CDN系统，送照片就送856G流量，上面都是拿开源软件做的，我们做成了一个自主开发的CDN系统，今年会建到2400G，按照淘宝流量的增长，能力到2400G，实际的量可能会在2000G左右。TFS是自主开发的分布式对象存储系统，目前有6.2P存储空间，实际用了4P多，今年会建设到12P。

每G存储成本会逐渐下降，今年到2.5元。Oceanbase，一张表格里大概有120亿条的收藏记录。核心数据库，采用开源的MySQL，机上高速的非易先存储，以及多层级优化。旺旺平台，自主开发。底层的支撑软件，在OpenJDK基础上开发和维护Taoboo JVM，在LVS基础上实现负载均衡解决方案，用开源软件实现了高流量的网络镜像项目，可以说淘宝整个平台是建在开源软件加自主开发的基础上，核心系统没有商用软件，淘宝不是第一天是这个样子的，我们讲一个事例。

###大数据=高成本

淘宝最早是做交易网站的，一块是都是花钱解决问题，最终花钱解决不了问题了，不得不自己走上这条道路，我们可以拿三个事例来说明，图片存储，淘宝上有很多商品，卖家拍了很多商品照片，平均一个商品可能有三四十张以上的图片，一开始花钱解决问题，买的是NAS系统，然后往里面放，到2006年的时候，从最低端升级到最高端设备，因为是笑图片，最高端的存储控制没用完，但是文件个数已经用爆了，数目不够，工程师说一台放不下买两台，两台放不下放四台，我们自己知道这个不是解决办法，因为成本很高，那时候10T存储空间就要几百万，我们自己做了一个面向图片存储的管理系统，在架构上我们做了一些取舍，分布式文件系统由原数据服务器、数据服务器两部分组成。

对于互联网图片数据来说，用户并不关心文件名是什么、路径是什么，只是在网页里能把图片展示出来，我们把目录空间抛弃掉了，我们做了取舍，没有目录空间，做了对象存储，你要放进来一个对象，自己还不能起名字，是我们赋予的，这样可以做到非常高速。比如中间有一个图片名字，一般人看不懂，原数据可以变的很简单，直接可以映射到物理机器，原数据很简单，数据量很少，分布式系统里原数据一定是最终瓶颈，做的越简单可扩展性越好。上线一用规模可能就大了一个数量级，后续逐渐优化，增加各种功能，现在TFS也开源了，2.0版本我们还在持续优化，我们内部都有指标。

###淘宝CDN系统

淘宝CDN系统，一开始也是花钱解决问题，最早淘宝CND系统都是买商用负载均衡器，因为是图片，随即访问，后来逐步改造，用开源的软件，包括混合存储，原来建6G要花掉200多万，去年建10G35万就可以做到了，2010年光KPI就节约了1亿多，因为规模大了，稍微优化一下就可以节约1亿多，这里面我们提了很多做法，以后我们会有大型的节点，在调度力度和用户体验上都会做进一步优化。

###淘宝核心数据库

第三是淘宝核心数据库，最后一个被拔掉的，最早拿IBM小型机、思科商用数据库、EMC高端存储，好处是功能比较强大，缺点就是比较贵。2008年开始使用MySQL数据库，2011年组建了自己MySQL开发团队，开发团队只有8人，去年最早把商品库换掉了，十亿多个商品，交易数据库过去2000万IOE解决方案，那时候每秒钟只能做3000笔交易，2011年原定目标是平台要做到5000笔交易就能支撑业务的发展，后来我们用MySQL加上优化，一台机器做到1万笔交易，当然了不是普通的PC服务器，是9万元的PC服务器，再加上FLASH卡，总共不到12万元，整个淘宝平台的交易能力一秒钟能做到16万笔交易，商用软件已经不能满足大规模系统的需要，开源自主开发有很好的可控性和可扩展性，我们有个规模效应，比如这个图横坐标是规模，规模由小变大的时候，一开始自己研发，投入的起点可能比较高，随着规模增大，斜线不高，如果一开始租或者买，投入的起点已经必定低，随着规模增长，斜率比较高，两条斜线肯定相交于一点，过了这个交差点自己做一定划算，我们在商用软件上碰上问题，商用厂商并不全力支持我们，全世界可能就我们一家是这种用法，逼着规模大的不得不自己做。

淘宝乐于开源

过去我们使用了大量开源软件，也在开源基础上做改进、定制，把工作成果回馈给开源社区，在Linux内核上，目前内核贡献量在全世界排115名。我们也建设了开源的平台，把淘宝大部分数得上名字的基础软件都开源出来了，我们有这样的开源平台，不光软件开源，硬件也做了定制的低功耗服务器，我们做了绿色计算网站，服务器定制只是其中一块，数据中心、机房的基础设施、机柜的定制可能是绿色计算很大一块，建这样的网站，尤其是国内，用中文交流可能更方便，可以在一块推进整个绿色计算的发展。

小结

淘宝是开源系统的受益者，并积极参与开源生态系统的建设，促进开源生态系统的发展，积累更好的口碑，凝聚人才，迎接未来更大的技术挑战。淘宝公司希望以更开放的方式与世界一起进行技术创新。




转自<http://www.csdn.net/article/a/2012-06-29/2807025>